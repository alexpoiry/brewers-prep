<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Loading…</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    input, button { padding: 0.5rem; font-size: 1rem; margin-right: 0.5rem; }
    #found-list, #all-list { margin-top: 1rem; }
    #found-list li, #all-list li { margin: 0.25rem 0; }
  </style>
</head>
<body>
  <h1></h1>
  <p></p>
  <input type="text" id="beer-input" autocomplete="off" placeholder="" />
  <button id="add-button">Add</button>
  <button id="toggle-all-button">Show All Styles</button>

  <h2>Your Correct Answers</h2>
  <ul id="found-list"></ul>

  <h2>All Styles</h2>
  <ul id="all-list" style="display:none;"></ul>

  <script>
    async function init() {
      const params = new URLSearchParams(location.search);
      const source = params.get('source') || 'ba';
      const key = params.get('style');
      if (!key) return document.body.innerHTML = '<p style="color:red">No style specified.</p>';

      // Choose JSON based on source param
      const resp = await fetch(source === 'bjcp' ? 'bjcp-styles.json' : 'styles.json');
      const data = await resp.json();
      const { display, beers } = data[key] || {};
      if (!display) return document.body.innerHTML = `<p style="color:red">Style “${key}” not found.</p>`;

      document.title = `${display} Quiz`;
      document.querySelector('h1').textContent = `${display} Quiz`;
      document.querySelector('p').textContent = `Type the name of a ${display}:`;
      const inputEl = document.getElementById('beer-input');
      const addBtn = document.getElementById('add-button');
      const toggleAllBtn = document.getElementById('toggle-all-button');
      const foundList = document.getElementById('found-list');
      const allList = document.getElementById('all-list');

      // Normalize and map answers
      const normMap = {};
      beers.forEach(orig => {
        const base = orig.toLowerCase().replace(/-/g, ' ').replace(/\s+/g, ' ').trim();
        normMap[base] = orig;
        orig.split(/\s+or\s+/i).forEach(part => {
          const pnorm = part.toLowerCase().replace(/-/g, ' ').replace(/\s+/g, ' ').trim();
          normMap[pnorm] = orig;
        });
      });
      const found = new Set();
      let allPopulated = false;

      function addBeer() {
        const name = inputEl.value.trim().toLowerCase().replace(/-/g, ' ').replace(/\s+/g, ' ').trim();
        inputEl.value = '';
        inputEl.focus();
        const match = normMap[name];
        if (match && !found.has(match)) {
          found.add(match);
          const li = document.createElement('li');
          li.textContent = match;
          foundList.appendChild(li);
        }
      }

      function toggleAll() {
        if (allList.style.display === 'none') {
          if (!allPopulated) {
            beers.forEach(orig => {
              const li = document.createElement('li');
              const a = document.createElement('a');
              const quizPage = source === 'bjcp' ? 'bjcp-details-quiz.html' : 'characteristics-quiz.html';
              a.textContent = orig;
              a.href = `${quizPage}?source=${source}&style=${encodeURIComponent(orig)}`;
              li.appendChild(a);
              allList.appendChild(li);
            });
            allPopulated = true;
          }
          allList.style.display = 'block';
          inputEl.disabled = true;
          addBtn.disabled = true;
          toggleAllBtn.textContent = 'Hide All Styles';
        } else {
          allList.style.display = 'none';
          inputEl.disabled = false;
          addBtn.disabled = false;
          toggleAllBtn.textContent = 'Show All Styles';
        }
      }

      addBtn.addEventListener('click', addBeer);
      inputEl.addEventListener('keypress', e => { if (e.key === 'Enter') addBeer(); });
      toggleAllBtn.addEventListener('click', toggleAll);
    }
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>